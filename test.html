<!DOCTYPE html>
<html>
<head>
    <title>Healthcare Dataset WDC</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
    <script>
        // Create a new Web Data Connector instance
        var myConnector = tableau.makeConnector();

        // Define the schema for your data
        myConnector.getSchema = function (schemaCallback) {
            var cols = [
                { id: "state", dataType: tableau.dataTypeEnum.string },
                { id: "program_type", dataType: tableau.dataTypeEnum.string },
                { id: "last_updated", dataType: tableau.dataTypeEnum.datetime },
                { id: "data_value", dataType: tableau.dataTypeEnum.float }
            ];

            var tableSchema = {
                id: "healthcareData",
                alias: "Healthcare Data",
                columns: cols
            };

            schemaCallback([tableSchema]);
        };

        // Fetch data from the API and populate the table
        myConnector.getData = function (table, doneCallback) {
            $.getJSON("https://data.healthcare.gov/resource/pwgg-dtft.json", function (data) {
                var tableData = [];

                // Process the API response and format it for Tableau
                for (var i = 0; i < data.length; i++) {
                    tableData.push({
                        "state": data[i].state,
                        "program_type": data[i].program_type,
                        "last_updated": new Date(data[i].last_updated),
                        "data_value": parseFloat(data[i].data_value)
                    });
                }

                table.appendRows(tableData);
                doneCallback();
            });
        };

        // Register the connector
        tableau.registerConnector(myConnector);

        // Trigger the connector
        $(document).ready(function () {
            $("#submitButton").click(function () {
                tableau.connectionName = "Healthcare Dataset Connector";
                tableau.submit();
            });
        });
    </script>
</head>
<body>
    <h1>Healthcare Dataset Web Data Connector</h1>
    <p>Click the button to connect to the healthcare dataset:</p>
    <button id="submitButton">Connect</button>
</body>
</html>
