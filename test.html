<!DOCTYPE html>
<html>

<head>
    <title>Census Population WDC</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-4.0.latest.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h1>Census Population Data Connector</h1>
    <div id="wdcContainer">
        <button id="connectButton">Connect to Census Population API</button>
    </div>

    <script>
        (function () {
            var myConnector = tableau.makeConnector();

            myConnector.getSchema = function (schemaCallback) {
                // Define your schema here (columns and their data types)
                var schema = [
                    {
                        id: "state",
                        dataType: tableau.dataTypeEnum.string
                    },
                    {
                        id: "population",
                        dataType: tableau.dataTypeEnum.int
                    },
                    // Add more columns based on the actual structure of the data
                ];

                var tableInfo = {
                    id: "censusPopulationData",
                    alias: "Census Population Data",
                    columns: schema
                };

                schemaCallback([tableInfo]);
            };

            myConnector.getData = function (table, doneCallback) {
                // Make an AJAX request to fetch data from the Census Population API
                $.ajax({
                    url: "https://api.census.gov/data/2021/pep/population",
                    dataType: "json",
                    success: function (data) {
                        var tableData = [];

                        // Process and format the API response into tableData
                        // Assuming the structure of the data is { state: ..., population: ... }
                        data.forEach(function (row) {
                            tableData.push({
                                state: row.state,
                                population: row.population,
                                // Add more fields based on the actual structure of the data
                            });
                        });

                        table.appendRows(tableData);
                        doneCallback();
                    }
                });
            };

            tableau.registerConnector(myConnector);

            $(document).ready(function () {
                $("#connectButton").click(function () {
                    tableau.connectionName = "Census Population Data";
                    tableau.submit();
                });
            });
        })();
    </script>
</body>

</html>
