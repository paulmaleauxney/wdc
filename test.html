<!DOCTYPE html>
<html>
<head>
    <title>Blockstream WDC</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-4.0.latest.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Blockstream API Connector</h1>
    <div id="wdcContainer">
        <button id="connectButton">Connect to Blockstream API</button>
    </div>

    <script>
        (function() {
            var myConnector = tableau.makeConnector();

            myConnector.getSchema = function(schemaCallback) {
                // Define your schema here (columns and their data types)
                var schema = [
                    {
                        id: "field1",
                        dataType: tableau.dataTypeEnum.string
                    },
                    {
                        id: "field2",
                        dataType: tableau.dataTypeEnum.int
                    },
                    // Add more columns as needed
                ];

                var tableInfo = {
                    id: "blockstreamData",
                    alias: "Blockstream Data",
                    columns: schema
                };

                schemaCallback([tableInfo]);
            };

            myConnector.getData = function(table, doneCallback) {
                // Make an AJAX request to fetch data from the API
                $.ajax({
                    url: "https://blockstream.info/api/blocks/tip/hash",
                    dataType: "json",
                    success: function(data) {
                        var tableData = [];

                        // Process and format the API response into tableData
                        // Loop through data and push rows into tableData

                        table.appendRows(tableData);
                        doneCallback();
                    }
                });
            };

            tableau.registerConnector(myConnector);

            $(document).ready(function() {
                $("#connectButton").click(function() {
                    tableau.connectionName = "Blockstream API Data";
                    tableau.submit();
                });
            });
        })();
    </script>
</body>
</html>
